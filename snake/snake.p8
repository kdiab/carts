pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- update - 30 fps update frames
function game_update()
	is_dead()
	if game_state == "dead" then
			state = "restart"
	end
 if game_state == "alive" then
		if btn(➡️) and dvector.d !=2 then
			direction = 0
		end
		if btn(⬆️) and dvector.d !=3 then 
			direction = 1
		end
		if btn(⬅️) and dvector.d !=0 then
			direction = 2
		end
		if btn(⬇️) and dvector.d !=1 then
			direction = 3
		end
		dvector.d = direction
		move()
		if is_outofbounds(snake[1]) then
				game_state = "dead"
		end
		wait(3)
	 if overlap(snake[1], apple) then
	 		-- move apple + inc size
	 		apple = spawn_apple()
	 		inc_size()
	 end
 end
end

-- draw - 30fps rendering
function game_draw()
  cls(13)
  map()
		if game_state == "alive" then
			spr(dvector.d, snake[1].x, snake[1].y)
			for i = 2, #snake do
	  	local s = snake[i]
	  	spr(4, s.x, s.y)
			end
			spr(5, apple.x, apple.y)
		end
		if game_state == "dead" then
			for i = 2, #snake do
	  	local s = snake[i]
	  	spr(4, s.x, s.y)
			end
			spr(dvector.d+6, snake[1].x, snake[1].y)
		end
		-- print(overlap(snake[1], apple))
		-- print(is_dead())
		-- print(is_outofbounds(snake[1]))
end

function move()
	head = {x=snake[1].x, y=snake[1].y}
	if dvector.d == 0 then
			snake[1].x += 8
	end
	if dvector.d == 1 then
			snake[1].y -= 8
	end
	if dvector.d == 2 then
			snake[1].x -= 8
	end
	if dvector.d == 3 then
			snake[1].y += 8
	end
	for i = 2, #snake do
 	temp = {x=snake[i].x, y=snake[i].y}
 	snake[i].x = head.x
 	snake[i].y = head.y
 	head = temp
	end

end

function wait(frames)
  for i = 1, frames do
    flip()  -- wait one frame
  end
end

function overlap(a, b)
		wh = 0
		return not (
		a.x > b.x + wh
		or a.y > b.y + wh
		or a.x + wh < b.x
		or a.y + wh < b.y)
end

function spawn_apple()
  local grid_offset = 8
  local available_pos = {}
  
  for x_pos = 0, 15 do
   for y_pos = 0, 15 do
   	local pos = {
   		x=x_pos*grid_offset,
   		y=y_pos*grid_offset
   	}
   	if is_available(pos) and not is_outofbounds(pos) then
   			add(available_pos, pos)
   	end
   end
  end
  if #available_pos > 0 then
  	local r_spot = available_pos[flr(rnd(#available_pos))+1]
  	return r_spot
  else
  print("you win!")
  end	
end

function is_available(a)
		for s in all(snake) do
				if (a.x == s.x and a.y == s.y) then
						return false
				end
		end
		return true
end

function inc_size()
		score += 1
		new_segment = {x=128, y=128}
		add(snake, new_segment)
end

function is_dead()
		for i = 2, #snake do
    if overlap(snake[1], snake[i]) then
    		game_state = "dead"
    end
  end 
end

function is_outofbounds(pos)
		return (
					pos.x > 112 
		or pos.x < 8 
		or pos.y > 112 
		or pos.y < 8
		) 
end

function game_reset()
		palt(15, true)
		palt(0, false)
  cls(5)
  game_state = "alive"
  score = 0
  direction = 0
  dvector = {d= 0, x=0, y=0}
  snake = {{x=64, y=64}}
		apple = spawn_apple()
		state = "start"
end
-->8
function _init()
		palt(15, true)
		palt(0, false)
  cls(5)
  game_state = "alive"
  score = 0
  direction = 0
  dvector = {d= 0, x=0, y=0}
  snake = {{x=64, y=64}}
		apple = spawn_apple()
		state = "menu"
		song_counter = 0
		current_song = 0
		music(current_song)
end

function _update()
		song_counter += 1
		if song_counter == 768 then
				switch_music()
		end
		if state == "start" then
				game_update()
		elseif state == "menu" then
				menu_update()
		elseif state == "restart" then
				restart_update()
		end
end

function _draw()
		if state == "start" then
				game_draw()
		elseif state == "menu" then
				menu_draw()
		elseif state == "restart" then
				restart_draw()
		end
end
-->8
function menu_update()
		if btn(❎) then
				state = "start"
		end
end

function menu_draw()
		cls()
		print("press ❎ to start", 30,63)
end
-->8
function restart_update()
		if btn(❎) then
				game_reset()
		end		
end

function restart_draw()
  spr(dvector.d+6, snake[1].x, snake[1].y)
		print("score: "..score, 30, 56, 1)
		print("press ❎ to restart",30,64,1)
end
-->8
function switch_music()
  if current_song == 0 then
  		current_song = 1
  else
  		current_song = 0
  end
  song_counter = 0
		music(current_song)
end
__gfx__
eeeeee0000eeee0007eeeeeeeedeedeee9eeee9effffffffeeeeee0880eeee0808eeeeeeeedeedee000000000ffffff00f8ff0f00ffffff00000000000000000
eeedde7007eeee7000eddeeeeeeddeee9dddddd9f888888feeedde8008eeee8080eddeeeeeeddeeeff0000fff8fffff0f0f88f8f0fffff8f0000000000000000
deeeddeeeeddddeeeeddeeedeeeeeeeeedeeeedef888888fdeeeddeeeeddddeeeeddeeedeeeeeeeeff0000ff0f000000ff8802ff000002f00000000000000000
edededeeeddeeddeeedededeededdedeededdedef888888fedededeeeddeeddeeedededeededdedeff0000fff8200000ff8200ff0000008f0000000000000000
edededeeededdedeeedededeeddeeddeededdedef888888fedededeeededdedeeedededeeddeeddeff0200fff8820000ff2000ff0002880f0000000000000000
deeeddeeeeeeeeeeeeddeeedeeddddeeedeeeedef888888fdeeeddeeeeeeeeeeeeddeeedeeddddeeff2802ff8f882000ff0000ff000028f00000000000000000
eeedde00eeeddeee07eddeee07eeee709dddddd9f888888feeedde08eeeddeee08eddeee08eeee80f8f88f8ff0fffff0ff0000ff0fffff8f0000000000000000
eeeeee70eedeedee00eeeeee00eeee00e9eeee9effffffffeeeeee80eedeedee80eeeeee80eeee088f0ff8f08ffffff0000000000ffffff00000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff8f8000000008f0ffff0000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000fff228fffff0000f820fff00000ffff0000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000ff02000fff0000082000ff000000fff0000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000fff000000f82000f0000000ff0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff00000f0ff2000000f00000f0000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff00022ff0fff000000ff020200000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffff828fff0ffff00000fff828f0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008f8ffff0000000000ffff8f80000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000001010101000000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a0c0c0c0c0c0c0c0c0c0c0c0c0c0c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
491000200c0233f2153f2151b3150c0232461500000246150c0233f2151b2153f31524625000003f2153f2150c0231b2151b4151b6150c0232461500000000000c0233f2153f4153f1150c023000003f3153f315
d7100010207551873523745227051a7551e7551a7551f7551d75523705207552575522705207551d75523755257052b7052470528705227052270522705227052270523705237052470524705247052270522705
d31000200c75510755137051375513755107550c755107550e7550e7551c70511755137553370513755177550c7551075517755347050c755107550e755337050e7550e7551c705117551375533705137550c705
611000000c523106001060010541106000c52310541005000c5231061300500106130c5231060010541106000c5231060010600106000c5231054110541106000c52300500106130050010613106001060010600
011000000210002100021000210002100021000210002100021000210002100021000210002100021000210002145021250211502145021250211502100021000210002100021000210002100021000210002100
191000001070500705287552b7552675500705247550070500705007050070500705007050070500705007050070500705247552675529755007052b755007052875528700287000070500705007052670000705
011000001070500705287552b7552675500705247550070500000000000000000000000000000000000000002875500705247002670029700007052b755007052875500000247552670029755000002670000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100e012f0702c0702d06019060180702b06017050150602d0602d0702e0502f0502b0502f05030050300702f0502e0502d0502b0702a0701a070180601705021050200701e0502005021050210503107000070
__music__
03 03020405
03 02030406
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 42424344

